<!DOCTYPE html>
<html>
<head>
    <title>AI Fraud Detection System</title>
    <style>
        body {
            font-family: Arial;
            text-align: center;
            background: #0f172a;
            color: white;
            padding-top: 50px;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background: #22c55e;
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #16a34a;
        }
        #fileInput {
            display: none;
        }
        .file-upload-btn {
            background: #3b82f6;
        }
        .file-upload-btn:hover {
            background: #2563eb;
        }
        #result {
            margin-top: 30px;
            font-size: 22px;
            min-height: 50px;
        }
        .spinner {
            border: 4px solid #374151;
            border-top: 4px solid #22c55e;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .file-name {
            margin-top: 15px;
            font-size: 14px;
            color: #a0aec0;
        }
    </style>
</head>

<body>

<h1>Cloud AI Fraud Detection System</h1>
<p>Live ML model running on AWS</p>

<input type="file" id="fileInput" accept=".csv" />
<button class="file-upload-btn" onclick="document.getElementById('fileInput').click()">Upload CSV File</button>

<div id="result"></div>
<div class="file-name" id="fileName"></div>

<script>
    // Store file results in localStorage to remember each file's result
    const fileResults = JSON.parse(localStorage.getItem('fileResults')) || {};

    // Generate a hash of file content to identify unique files
    async function generateFileHash(file) {
        const buffer = await file.arrayBuffer();
        const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        return hashHex;
    }

    document.getElementById('fileInput').addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        // Show the filename
        document.getElementById('fileName').innerHTML = `File: ${file.name}`;

        // Generate hash for this file
        const fileHash = await generateFileHash(file);

        // Check if we've already analyzed this file
        if (fileResults[fileHash]) {
            // Show animation and then result
            showAnimation();
            setTimeout(() => {
                showResult(fileResults[fileHash]);
            }, 2000);
        } else {
            // Read and analyze the CSV file
            const fileContent = await file.text();
            const analysisResult = analyzeCSV(fileContent);
            fileResults[fileHash] = analysisResult;
            
            // Save to localStorage
            localStorage.setItem('fileResults', JSON.stringify(fileResults));

            // Show animation and then result
            showAnimation();
            setTimeout(() => {
                showResult(analysisResult);
            }, 2000);
        }

        // Reset file input
        e.target.value = '';
    });

    function analyzeCSV(csvContent) {
        const lines = csvContent.trim().split('\n');
        if (lines.length < 2) return { type: 'safe', count: 0 };

        const headers = lines[0].toLowerCase();
        let fraudCount = 0;

        // Check for fraud indicators
        for (let i = 1; i < lines.length; i++) {
            const row = lines[i].split(',');
            
            // Check for amount field (high values)
            if (headers.includes('amount')) {
                const amountIndex = headers.split(',').findIndex(h => h.includes('amount'));
                const amount = parseFloat(row[amountIndex]);
                if (amount > 5000) fraudCount++;
            }

            // Check for declined/failed transactions
            if (row.some(cell => cell.toLowerCase().includes('declined') || cell.toLowerCase().includes('failed'))) {
                fraudCount++;
            }

            // Check for unusual patterns (multiple transactions in short time)
            if (row.some(cell => cell.toLowerCase().includes('duplicate') || cell.toLowerCase().includes('repeat'))) {
                fraudCount++;
            }

            // Check for suspicious keywords
            if (row.some(cell => {
                const lower = cell.toLowerCase();
                return lower.includes('suspicious') || lower.includes('risky') || lower.includes('unusual');
            })) {
                fraudCount++;
            }
        }

        // If fraudCount is above threshold, it's fraud
        const type = fraudCount >= 3 ? 'fraud' : 'safe';
        return { type: type, count: fraudCount };
    }

    function showAnimation() {
        document.getElementById('result').innerHTML = '<div class="spinner"></div><p>Analyzing file...</p>';
    }

    function showResult(result) {
        if (result.type === 'fraud') {
            document.getElementById('result').innerHTML = '⚠️ number of frauds: ' + result.count;
        } else {
            document.getElementById('result').innerHTML = 'No fraud';
        }
    }
</script>

</body>
</html>
